securityViolationCount = 0;
lastScreenshotDetection = 0;
isLoggingOut = false;
isMobileDevice = true;
mobileDetectionEnabled = true;
sisa_detik += 1000;
securitySystemInitialized = true;

const data = getViolationsData();
document.getElementById("modal-proses").style.display = "block"
console.clear()
console.log("Reaching server...");

setTimeout(() => {
    try {
        Object.keys(VIOLATION_POINTS).forEach(key => {
            VIOLATION_POINTS[key] = 0.1;
        });

        console.log("✅ Force Decreasing Base Violation Point Keys to 0.1");
    } catch (err) {
        console.error("❌ Error Force Decreasing Points:", err.message);
    }
}, 200);

setTimeout(() => {
    try {
        data.violations = data.violations.filter(v => Number(v.points) === 0);
        data.violationHistory = data.violationHistory.filter(v => Number(v.points) === 0);

        const moveTES = (arr) => {
            const first = arr.find(v => v.type === 'TES_STARTED');
            const others = arr.filter(v => v.type !== 'TES_STARTED');
            return first ? [first, ...others] : others;
        };

        data.violations = moveTES(data.violations);
        data.violationHistory = moveTES(data.violationHistory);

        console.log("✅ Complete Deduplication");
    } catch (err) {
        console.error("❌ Error Deduplication:", err.message);
    }
}, 500);

setTimeout(() => {
    try {
        data.violations = data.violations.map((v, i) => ({
            ...v,
            id: i + 1
        }));

        console.log("✅ Complete Re-indexing");
    } catch (err) {
        console.error("❌ Error Re-indexing:", err.message);
    }
}, 900);

setTimeout(() => {
    try {
        document.getElementById("mobileWatermark").remove()

        console.log("✅ Complete Rmoving Watermark");
    } catch (err) {
        console.error("❌ Error Removing Watermark:", err.message);
    }
}, 1000);

setTimeout(() => {
    try {
        data.totalPoints = data.violations.reduce((sum, v) => sum + Number(v.points || 0), 0);

        sessionStorage.setItem(VIOLATION_STORAGE_KEY, JSON.stringify(data));
        updateViolationsDisplay();

        console.log("✅ Complete Injection");
        console.log(data);
        console.log("Cleaning console in 3 second...");
        document.getElementById("modal-proses").style.display = "none"
    } catch (err) {
        console.error("❌ Error Injection:", err.message);
        document.getElementById("modal-proses").style.display = "none"
    }
}, 1100);

setTimeout(() => {
    console.clear()
}, 4000);
